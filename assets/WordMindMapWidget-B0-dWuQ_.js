import{K as e,Nt as t,jt as n,kt as r,tt as i,z as a}from"./index-D5xtHDuG.js";import{t as o}from"./Shared-CEi_3vw0.js";var s=t(n(),1),c=a();const l=({className:t,style:n,gridSize:a,isStickerMode:l})=>{let u=r(),[d,f]=(0,s.useState)([]),[p,m]=(0,s.useState)(!0),[h,g]=(0,s.useState)([]),_=(0,s.useRef)(null),v=(0,s.useRef)(void 0),y=async()=>{m(!0);let e=localStorage.getItem(`accessToken`);if(!e){m(!1);return}try{let t=await fetch(`/api/persona`,{headers:{Authorization:`Bearer ${e}`}});if(t.ok&&t.status!==204)try{let e=await t.text();if(!e){f([]);return}let n=JSON.parse(e);if(Array.isArray(n)&&n.length===0){f([]);return}let r=n;if(typeof n.analysisResult==`string`)try{r=JSON.parse(n.analysisResult)}catch{}r&&r.wordCloud?f(r.wordCloud):f([])}catch(e){console.error(`JSON Parse Error:`,e),f([])}}catch(e){console.error(e)}finally{m(!1)}};(0,s.useEffect)(()=>{y()},[]);let b=(a?.w||2)===1&&(a?.h||1)===1,x=[`text-indigo-600`,`text-rose-600`,`text-teal-600`,`text-violet-600`,`text-amber-600`,`text-fuchsia-600`];if((0,s.useEffect)(()=>{if(!b||d.length===0){v.current&&cancelAnimationFrame(v.current);return}let e=d.slice(0,6).map((e,t)=>{let n=.8;t===0?n=1.6:t===1?n=1.2:t===2&&(n=1);let r=20+Math.random()*60,i=20+Math.random()*60,a=.05+Math.random()*.05,o=Math.random()*Math.PI*2;return{...e,x:r,y:i,vx:Math.cos(o)*a,vy:Math.sin(o)*a,size:n,widthEst:e.text.length*n*9,heightEst:n*16,color:x[t%x.length]}}),t=()=>{e=e.map(t=>{let{x:n,y:r,vx:i,vy:a,size:o}=t;return n+=i,r+=a,(n<=20||n>=80)&&(i=-i),(r<=20||r>=80)&&(a=-a),n<20&&(n=20),n>80&&(n=80),r<20&&(r=20),r>80&&(r=80),e.forEach(e=>{if(e===t)return;let s=n-e.x,c=r-e.y,l=Math.sqrt(s*s+c*c),u=(o+e.size)*7.5;if(l<u&&!(o>e.size))if(o<e.size){let e=Math.atan2(c,s),t=Math.sqrt(i*i+a*a),o=Math.max(t,.1);i=Math.cos(e)*o,a=Math.sin(e)*o;let d=u-l;n+=Math.cos(e)*d*.1,r+=Math.sin(e)*d*.1}else i=-i,a=-a,n+=s*.05,r+=c*.05}),{...t,x:n,y:r,vx:i,vy:a}}),g([...e]),v.current=requestAnimationFrame(t)};return v.current=requestAnimationFrame(t),()=>{v.current&&cancelAnimationFrame(v.current)}},[d,b]),p)return(0,c.jsx)(o,{className:`bg-white ${t||``}`,style:n,children:(0,c.jsx)(`div`,{className:`flex items-center justify-center h-full text-gray-400`,children:(0,c.jsx)(i,{className:`animate-spin w-5 h-5`})})});if(d.length===0)return(0,c.jsx)(o,{className:`bg-white ${t||``}`,style:n,title:`Key`,children:(0,c.jsxs)(`div`,{className:`flex flex-col items-center justify-center h-full text-center gap-3 p-4`,children:[(0,c.jsxs)(`div`,{className:`flex flex-col items-center gap-1`,children:[(0,c.jsx)(e,{className:`w-8 h-8 text-indigo-300 opacity-50`}),(0,c.jsx)(`span`,{className:`text-xs text-gray-400 font-medium`,children:`발견된 키워드가 없어요`})]}),(0,c.jsx)(`button`,{onClick:()=>!l&&u(`/profile/analysis`),className:`px-3 py-1.5 bg-indigo-50 hover:bg-indigo-100 text-indigo-600 text-[10px] font-bold rounded-lg transition-colors`,children:`분석하러 가기`})]})});if(b)return(0,c.jsx)(o,{className:`bg-white overflow-hidden relative ${t||``}`,style:n,children:(0,c.jsx)(`div`,{className:`w-full h-full relative`,ref:_,children:h.map((e,t)=>(0,c.jsx)(`div`,{className:`absolute font-black whitespace-nowrap leading-none transition-colors duration-500 ${e.color} select-none`,style:{left:`${e.x}%`,top:`${e.y}%`,fontSize:`${e.size}rem`,transform:`translate(-50%, -50%)`,zIndex:10-t},children:e.text},t))})});let S=d.slice(0,11);return(0,c.jsxs)(o,{className:`bg-white ${t||``}`,style:n,children:[(0,c.jsxs)(`div`,{className:`absolute top-3 left-4 text-[10px] font-bold text-gray-300 uppercase tracking-widest pointer-events-none flex items-center gap-1.5 z-0`,children:[(0,c.jsx)(e,{size:10}),`Mind Map`]}),(0,c.jsx)(`div`,{className:`w-full h-full relative overflow-hidden`,children:S.map((e,t)=>{let n=t===0,r=50,i=50;if(!n){let e=10+t*.8,n=t*2.4;r=50+Math.cos(n)*e*1.8,i=50+Math.sin(n)*e*1.3}let a=n?x[0]:x[t%x.length],o=`1.0rem`,s=`600`,l=10-t;return n?(o=`2.5rem`,s=`900`,l=20):t<4&&(o=`1.4rem`,s=`700`),(0,c.jsx)(`div`,{className:`absolute select-none whitespace-nowrap leading-none transition-all duration-300 ${a}`,style:{left:`${r}%`,top:`${i}%`,transform:`translate(-50%, -50%)`,fontSize:o,fontWeight:s,zIndex:l,opacity:n?1:.85,textShadow:n?`0 4px 12px rgba(0,0,0,0.1)`:`none`},title:`${e.value} mentions`,children:e.text},t)})})]})};export{l as WordMindMapWidget};